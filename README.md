# FamilyHub - Семейный органайзер

## Оглавление

- [Описание проекта](#описание-проекта)
- [Функциональные возможности](#функциональные-возможности)
- [Технологический стек](#технологический-стек)
- [Архитектура приложения](#архитектура-приложения)
- [Структура проекта](#структура-проекта)
- [Запуск приложения](#запуск-приложения)
- [Конфигурация](#конфигурация)
- [Структура базы данных](#структура-базы-данных)
- [Клиентская архитектура](#клиентская-архитектура)

---

## Описание проекта

FamilyHub - это полнофункциональное веб-приложение для организации семейной жизни и управления задачами. Система разработана для помощи семьям в координации повседневных дел, отслеживании выполнения задач и анализе продуктивности всех членов семьи.

Приложение построено на современном технологическом стеке с использованием серверной архитектуры на Node.js/Express и клиентской части на чистом JavaScript без использования фреймворков. Данные хранятся в реляционной базе данных MySQL с поддержкой полной нормализации и внешних ключей.

## Функциональные возможности

### Система аутентификации и авторизации
- Регистрация новых пользователей с ролями (родитель/ребенок)
- Безопасная аутентификация с хешированием паролей
- Управление сессиями через localStorage
- Поддержка иерархии пользователей (родитель-ребенок)

### Управление членами семьи
- Добавление и редактирование профилей членов семьи
- Кастомизация аватаров с поддержкой загрузки изображений
- Назначение ролей и цветовых схем
- Система баллов и отслеживание прогресса
- Просмотр статистики по каждому члену семьи

### Система управления задачами
- Создание задач с категоризацией (Дом, Учеба, Работа, Личное)
- Назначение задач конкретным членам семьи
- Установка периодов выполнения (сегодня, на неделе, на месяце)
- Фильтрация задач по категориям и периодам
- Отметка выполнения и подтверждение задач
- Удаление и редактирование задач

### Статистика и аналитика
- Дашборд с общей статистикой по задачам
- Графики и диаграммы выполнения задач
- Анализ продуктивности по членам семьи
- Сравнение показателей за разные периоды
- Отслеживание трендов и динамики

### Система отчетов
- Генерация детализированных отчетов за выбранные периоды
- Фильтрация по датам и членам семьи
- Экспорт данных о выполненных задачах
- Визуализация прогресса

### Интерфейс и UX
- Адаптивный дизайн для различных устройств
- Поддержка светлой и темной темы
- Плавные анимации и переходы
- Анимированный фон с частицами на экране входа
- Модальные окна и уведомления
- Интуитивная навигация

## Технологический стек

### Backend технологии
- **Node.js** (v14+) - серверная платформа выполнения JavaScript
- **Express.js** v4.18.2 - минималистичный веб-фреймворк для Node.js
- **MySQL2** v3.6.5 - современный драйвер для MySQL с поддержкой промисов
- **bcrypt** v5.1.1 - библиотека для хеширования паролей (10 раундов)
- **CORS** v2.8.5 - middleware для настройки Cross-Origin Resource Sharing
- **dotenv** v16.3.1 - загрузка переменных окружения из .env файлов
- **body-parser** v1.20.2 - парсинг входящих HTTP запросов
- **nodemon** v3.0.2 (dev) - автоматическая перезагрузка сервера при разработке

### Frontend технологии
- **HTML5** - семантическая разметка приложения
- **CSS3** - стилизация с использованием:
  - CSS Custom Properties (переменные)
  - Flexbox и Grid Layout
  - CSS Animations и Transitions
  - Media Queries для адаптивности
- **JavaScript (ES6+)** - клиентская логика:
  - Async/Await для асинхронных операций
  - Fetch API для HTTP запросов
  - LocalStorage для хранения сессий
  - Event Delegation
  - Модульная архитектура
- **Canvas API** - реализация анимации частиц

### База данных
- **MySQL** v8.0+ - реляционная СУБД
- **Кодировка**: utf8mb4_unicode_ci (полная поддержка Unicode)
- **Storage Engine**: InnoDB (транзакции и внешние ключи)

### Инфраструктура
- **npm** - управление пакетами и зависимостями
- **Git** - система контроля версий
- **Batch Scripts** - автоматизация запуска на Windows

## Архитектура приложения

### Клиент-серверная архитектура
Приложение построено по классической клиент-серверной модели:

```
┌─────────────────┐         HTTP/REST API          ┌─────────────────┐
│                 │ ◄──────────────────────────────► │                 │
│   Browser       │         JSON responses          │   Express.js    │
│   (Frontend)    │                                 │   (Backend)     │
│                 │                                 │                 │
└─────────────────┘                                 └────────┬────────┘
                                                             │
                                                             │ MySQL2
                                                             │ Pool
                                                             ▼
                                                    ┌─────────────────┐
                                                    │                 │
                                                    │   MySQL 8.0     │
                                                    │   Database      │
                                                    │                 │
                                                    └─────────────────┘
```

### Компоненты системы

#### Backend (Node.js/Express)
- **HTTP сервер** - обработка входящих запросов
- **RESTful API** - endpoints для всех операций
- **Connection Pool** - эффективное управление соединениями с БД
- **Middleware** - CORS, body parsing, кеширование
- **Static Server** - раздача frontend файлов

#### Frontend (SPA)
- **Single Page Application** - навигация без перезагрузки страницы
- **Модульная структура** - разделение логики по файлам
- **State Management** - управление состоянием через localStorage
- **Reactive Updates** - динамическое обновление UI

#### Database (MySQL)
- **Normalized Schema** - третья нормальная форма
- **Foreign Keys** - целостность данных
- **Indexes** - оптимизация запросов
- **Cascade Operations** - автоматическое удаление связанных записей

## Структура проекта

```
Tracking/
├── backend/                    # Серверная часть приложения
│   ├── server.js              # Основной файл сервера Express
│   ├── init-db.js             # Скрипт инициализации базы данных
│   ├── package.json           # Зависимости и скрипты backend
│   └── tracking.sql           # SQL-дамп структуры базы данных
├── frontend/                   # Клиентская часть приложения
│   ├── index.html             # Главная страница приложения
│   ├── assets/                # Статические ресурсы
│   │   └── logo.png           # Логотип приложения
│   ├── css/                   # Стили
│   │   └── style.css          # Основные стили приложения
│   └── js/                    # JavaScript модули
│       ├── auth.js            # Аутентификация и регистрация
│       ├── family.js          # Управление членами семьи
│       ├── main.js            # Основная логика и инициализация
│       ├── particles.js       # Анимация частиц на фоне
│       ├── reports.js         # Генерация отчетов
│       ├── statistics.js      # Статистика и графики
│       ├── tasks.js           # Управление задачами
│       └── ui.js              # Утилиты интерфейса
├── start_server.bat           # Скрипт запуска для Windows
└── README.md                  # Документация проекта
```

### Описание ключевых файлов

#### Backend файлы

**server.js** 
- Инициализация Express приложения
- Настройка middleware (CORS, body-parser, static)
- Connection pool для MySQL
- RESTful API endpoints:
  - `/api/register` - регистрация пользователей
  - `/api/login` - аутентификация
  - `/api/register-child` - регистрация детей
  - `/api/members/*` - CRUD операции для членов семьи
  - `/api/tasks/*` - управление задачами
  - `/api/statistics/:userId` - получение статистики
- Error handling и валидация данных

**init-db.js** 
- Подключение к MySQL серверу
- Создание базы данных `tracking`
- Создание таблиц: `users`, `members`, `tasks`
- Настройка индексов и внешних ключей
- Установка кодировки utf8mb4

**package.json**
- Метаданные проекта (название, версия, описание)
- Список dependencies для production
- DevDependencies для разработки
- NPM scripts: `start`, `dev`, `init-db`

#### Frontend файлы

**index.html** 
- Семантическая HTML5 структура
- Модальные окна для входа/регистрации
- Основной контейнер приложения
- Canvas для анимации частиц
- Подключение всех JS модулей

**css/style.css**
- CSS Custom Properties для тем
- Адаптивная сетка и компоновка
- Стили для всех компонентов
- Анимации и переходы
- Media queries для мобильных устройств

**js/auth.js** 
- `checkAuth()` - проверка авторизации
- `handleLogin()` - обработка входа
- `handleRegister()` - обработка регистрации
- `handleChildRegister()` - регистрация ребенка
- `logout()` - выход из системы
- Управление модальными окнами входа

**js/main.js** 
- Инициализация приложения
- Глобальные переменные состояния
- `showMainApp()` - отображение главного интерфейса
- `loadUserData()` - загрузка данных пользователя
- Обработчики событий
- Утилитарные функции

**js/family.js**
- `loadFamilyMembers()` - загрузка членов семьи
- `addFamilyMember()` - добавление нового члена
- `editFamilyMember()` - редактирование профиля
- `deleteFamilyMember()` - удаление члена семьи
- `showAddMemberModal()` - интерфейс добавления
- Управление аватарами

**js/tasks.js** 
- `loadTasks()` - загрузка задач с сервера
- `createTask()` - создание новой задачи
- `deleteTask()` - удаление задачи
- `toggleTaskCheck()` - отметка выполнения
- `filterTasks()` - фильтрация по периодам
- `renderTasksByCategory()` - группировка по категориям
- Управление состоянием задач

**js/statistics.js** 
- `showStatisticsPage()` - отображение страницы статистики
- `getStatisticsForPeriod()` - расчет метрик за период
- `generateStatsContent()` - генерация HTML статистики
- `updateStatisticsPeriod()` - обновление при смене периода
- Визуализация данных

**js/reports.js**
- `showReportsPage()` - интерфейс отчетов
- `generateReport()` - генерация отчета за период
- `filterReportData()` - фильтрация данных отчета
- `exportReport()` - экспорт данных
- Форматирование и вывод

**js/ui.js**
- `toggleTheme()` - переключение темы
- `showNotification()` - системные уведомления
- `showModal()` / `hideModal()` - управление модальными окнами
- `showConfirmDialog()` - диалоги подтверждения
- Вспомогательные UI функции

**js/particles.js**
- `initParticles()` - инициализация анимации
- Класс `Particle` - объект частицы
- `animateParticles()` - цикл анимации
- Canvas rendering

## Установка и настройка

### Системные требования

**Обязательное программное обеспечение:**
- **Node.js** версии 14.0 или выше
- **npm** версии 6.0 или выше (устанавливается автоматически с Node.js)
- **MySQL Server** версии 8.0 или выше
- **Веб-браузер** с поддержкой ES6+ (Chrome 90+, Firefox 88+, Edge 90+, Safari 14+)

**Рекомендуемые характеристики:**
- Операционная система: Windows 10/11, macOS 10.15+, Linux
- RAM: минимум 4 ГБ
- Свободное место на диске: 200 МБ

## Конфигурация

### Переменные окружения

Полный список поддерживаемых переменных окружения в файле `.env`:

| Переменная | Тип | По умолчанию | Описание |
|-----------|-----|--------------|----------|
| `DB_HOST` | string | `localhost` | Хост сервера MySQL |
| `DB_USER` | string | `root` | Имя пользователя MySQL |
| `DB_PASS` | string | `0000` | Пароль пользователя MySQL |
| `DB_NAME` | string | `tracking` | Имя базы данных |
| `PORT` | number | `3000` | Порт HTTP сервера |

### Настройка Connection Pool

В файле `server.js` настроены параметры пула соединений:

```javascript
const dbConfig = {
    host: process.env.DB_HOST || 'localhost',
    user: process.env.DB_USER || 'root',
    password: process.env.DB_PASS || '0000',
    database: process.env.DB_NAME || 'tracking',
    waitForConnections: true,     
    connectionLimit: 10,           
    queueLimit: 0                  
};
```

### Настройка CORS

CORS настроен для принятия запросов со всех источников:

```javascript
app.use(cors());
```

Для production рекомендуется ограничить источники:

```javascript
app.use(cors({
    origin: 'https://yourdomain.com',
    credentials: true
}));
```

### Отключение кеширования

Для динамических данных кеширование отключено:

```javascript
app.use((req, res, next) => {
    res.set('Cache-Control', 'no-store, no-cache, must-revalidate, private');
    res.set('Pragma', 'no-cache');
    res.set('Expires', '0');
    next();
});
```
## Структура базы данных

### Диаграмма схемы

```
┌─────────────────────────────────────────┐
│              users                      │
├─────────────────────────────────────────┤
│ PK  id                INT               │
│     family_name       VARCHAR(255)      │
│     email            VARCHAR(255) UNIQUE│
│     password         VARCHAR(255)       │
│     role             ENUM               │
│     name             VARCHAR(255)       │
│ FK  parent_id        INT (NULL)         │
│     created_at       TIMESTAMP          │
└─────────────────────────────────────────┘
           │
           │ 1:N
           ▼
┌─────────────────────────────────────────┐
│             members                     │
├─────────────────────────────────────────┤
│ PK  id               INT                │
│ FK  user_id          INT                │
│     name             VARCHAR(255)       │
│     role             VARCHAR(100)       │
│     avatar           TEXT               │
│     points           INT                │
│     tasks            VARCHAR(50)        │
│     color            VARCHAR(20)        │
│     created_at       TIMESTAMP          │
└─────────────────────────────────────────┘

           │
           │ 1:N
           ▼
┌─────────────────────────────────────────┐
│              tasks                      │
├─────────────────────────────────────────┤
│ PK  id               INT                │
│ FK  user_id          INT                │
│     name             VARCHAR(255)       │
│     category         VARCHAR(100)       │
│     assignee         VARCHAR(255)       │
│     period           VARCHAR(50)        │
│     is_checked       BOOLEAN            │
│     is_confirmed     BOOLEAN            │
│ FK  confirmed_by     INT (NULL)         │
│     confirmed_at     TIMESTAMP (NULL)   │
│     created_at       TIMESTAMP          │
└─────────────────────────────────────────┘
```

### Таблица users

Хранит информацию о зарегистрированных пользователях системы.

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Уникальный идентификатор |
| `family_name` | VARCHAR(255) | NOT NULL | Фамилия семьи |
| `email` | VARCHAR(255) | NOT NULL, UNIQUE | Email для входа |
| `password` | VARCHAR(255) | NOT NULL | Хеш пароля (bcrypt) |
| `role` | ENUM | NOT NULL, DEFAULT 'parent' | Роль: 'parent' или 'child' |
| `name` | VARCHAR(255) | NULL | Имя пользователя |
| `parent_id` | INT | NULL, FK → users(id) | ID родителя (для детей) |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания |

**Индексы:**
- PRIMARY KEY на `id`
- UNIQUE INDEX на `email`
- INDEX на `parent_id`

**Внешние ключи:**
- `parent_id` REFERENCES `users(id)` ON DELETE CASCADE

### Таблица members

Хранит профили членов семьи.

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Уникальный идентификатор |
| `user_id` | INT | NOT NULL, FK → users(id) | ID владельца профиля |
| `name` | VARCHAR(255) | NOT NULL | Имя члена семьи |
| `role` | VARCHAR(100) | NULL | Роль в семье (мама, папа, сын и т.д.) |
| `avatar` | TEXT | NULL | Base64 данные аватара |
| `points` | INT | DEFAULT 0 | Накопленные баллы |
| `tasks` | VARCHAR(50) | DEFAULT '0/0' | Статистика задач (выполнено/всего) |
| `color` | VARCHAR(20) | NULL | Цвет профиля (HEX) |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания |

**Индексы:**
- PRIMARY KEY на `id`
- INDEX на `user_id`

**Внешние ключи:**
- `user_id` REFERENCES `users(id)` ON DELETE CASCADE

### Таблица tasks

Хранит задачи и их статусы.

| Поле | Тип | Ограничения | Описание |
|------|-----|-------------|----------|
| `id` | INT | PRIMARY KEY, AUTO_INCREMENT | Уникальный идентификатор |
| `user_id` | INT | NOT NULL, FK → users(id) | ID создателя задачи |
| `name` | VARCHAR(255) | NOT NULL | Название задачи |
| `category` | VARCHAR(100) | NULL | Категория (Дом, Учеба, Работа, Личное) |
| `assignee` | VARCHAR(255) | NULL | Кому назначена задача |
| `period` | VARCHAR(50) | NULL | Период (today, week, month) |
| `is_checked` | BOOLEAN | DEFAULT FALSE | Отмечена как выполненная |
| `is_confirmed` | BOOLEAN | DEFAULT FALSE | Подтверждена родителем |
| `confirmed_by` | INT | NULL, FK → users(id) | ID подтвердившего |
| `confirmed_at` | TIMESTAMP | NULL | Дата подтверждения |
| `created_at` | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | Дата создания |

**Индексы:**
- PRIMARY KEY на `id`
- INDEX на `user_id`
- INDEX на `category`
- INDEX на `period`
- INDEX на `is_confirmed`

**Внешние ключи:**
- `user_id` REFERENCES `users(id)` ON DELETE CASCADE
- `confirmed_by` REFERENCES `users(id)` ON DELETE SET NULL

### Отношения между таблицами

1. **users ↔ users (самосоединение)**
   - Отношение: один-ко-многим
   - Родительский пользователь может иметь несколько дочерних аккаунтов
   - При удалении родителя удаляются все дочерние аккаунты (CASCADE)

2. **users → members**
   - Отношение: один-ко-многим
   - Один пользователь может иметь множество членов семьи
   - При удалении пользователя удаляются все его члены семьи (CASCADE)

3. **users → tasks**
   - Отношение: один-ко-многим
   - Один пользователь может создать множество задач
   - При удалении пользователя удаляются все его задачи (CASCADE)

4. **users → tasks (confirmed_by)**
   - Отношение: один-ко-многим (опциональное)
   - Пользователь может подтверждать задачи
   - При удалении пользователя поле confirmed_by обнуляется (SET NULL)

## Клиентская архитектура

### Модульная структура

Клиентская часть разделена на независимые модули для лучшей поддерживаемости:

```
Frontend Modules
├── main.js           # Точка входа, инициализация
├── auth.js           # Аутентификация
├── family.js         # Управление членами семьи
├── tasks.js          # Управление задачами
├── statistics.js     # Статистика и аналитика
├── reports.js        # Генерация отчетов
├── ui.js             # UI утилиты
└── particles.js      # Анимация фона
```
